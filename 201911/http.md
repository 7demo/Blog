# http权威指南

## 一 web基础

+ 通过设置`MIME(Multipurpose Internet Mail Extension)`（多用途因特网邮件扩展）设置相应类型，对应responsehead中的`content-type`。

+ URI 表示统一资源标识符，分为URL与URN。URL表示统一资源定位符，标识资源在网上的位置；URN表示统一资源名（未被广泛使用）。

+ get与post请求区别：

> 1.get请求数据在URL，post请求数据放到在请求体内

> 2.get的url最大长度为2048字符，即2个字节。post无限制。不过服务器一般限制64kb。

> 3.post除了ascii编码外，还支持2进制。

> 4，get回退刷新是无害，post会再次提交。并且get可以被缓存。

> 5. get是幂等，post是非幂等。

> 6. get与post的一个区别：post会把header与post分为两个tcp包，而get则是一个包上传的。不过只是某些浏览器实现的区别，比如firefox只发一次。

但是从tcp角度，二者是一样的。二者只是tcp的表现形式。

+ tcp提供"无差错传输、按序传输、未分段的数据流"

+ 网关：通常把http协议转为其他协议。

+ 隧道：在两条链接之前进行数据的盲目转发。http隧道通常在一条或者多条http链接上转发非http链接，比如ssl.

## uri

URL的协议方案由9个部分：

`协议://用户:密码@host:port/path;params?query#frag`

每条报文都包含起始行（协议、请求方法）、header、body

code:

100-101: 信息提示

200-206: 成功。200表示ok, 201表示created成功，202 Accept，表示已接受请求但是不保证处理完成。203表示响应首部是来自资源而非服务器。204响应没有实体内容。205用于浏览器，重置表单。206成功执行一部分，会有content-range

300-305: 重定向。300是指一个请求返回多个版本供选择。301请求时资源已被移走，返回location包含现在资源的URL。302与301类似，但在此请求的url还需要使用旧的url。303告知客户端使用另一url,多是将post请求的资源重定向到其他资源去。304，比如资源未被更改，只返回header，不返回body。305，使用代理地址访问资源，具体地址已在location中。

400-415: 客户端错误。400表示客户端发了错误请求，401未授权。403表示拒绝。404是not found，405表示方法不允许。406 not acceptabe.407表示客户端需要用代理。408表示超时。409表示服务端冲突。410与404类似，但是曾经有过。

500-505: 500表服务器错误，501客户端发起的请求超出服务器处理范围。502代理或者网关收到伪请求。503表示现在无法提供服务，但是未来可以。504代理与网关超时。505表示协议不支持。

HEAD方法是只返回header，可以用来：

1，了解资源情况

2，通过状态码查看资源是否存在

3，了解资源是否被修改过

首部分为：通用首部、请求首部、响应首部、实体首部(Content-type)、扩展首部

协议：http(应用层)、ssl(安全层)、tcp(传输层)、ip(网络层)、网络接口(网络链路层)。

数据是分段经tcp/ip传输的——是tcp把数据分段，把数据封到ip中。每段数据包含：

1, 一个ip分组首部（20字节）。包含源和目的地的ip地址，长度和其他一些标记（分组id、偏移量、校验）。

2，一个tcp端首部（20字节）。tcp端口号、tcp标记，数据完整与顺序性信息。

3，一个tcp数据块。

一个tcp由源地址+原地址端口号+目的地址+目的地址端口号定义。

TCP性能聚焦区：

1，tcp建立握手——三次握手。客户端发送tcp，包含SYN标记。服务器接受链接，发回一个tcp分组包含SYN于ACK标记，接受请求。客户端发送请求，通知确定建立链接。这个是一个http事物，会产生时延。

2，tcp延迟确认。接收到tcp分段数据，进行序列号与数据完整性校验。如果发送者在规定时间内没有收到回应，则认为失败会重发。由于回应数据比较小，则可以进行捎带——TCP允许将同方向的回应信息与输出信息结合在一起。所以TCP有一个“延迟确认”——在特定的时间窗口内（100-200毫秒内），将确认信息存在缓存，已寻找能捎带它的输出数据。如果超时未有捎带，则会单独发送。但是HTTP有双峰特征（请求-应答）——需求能捎带的输出数据时偏偏没那么多。

3，TCP慢启动。TCP链接会随着时间进行协调，在开始会限制最大连接速度，链接后，会增加最大连接速度。简单来说，发送成功一组数据，就可以增加两个分组的权限。两个发送成功，则可以发送4个分组——打开拥塞窗口。需要重用连接来优化。

4，算法鼓励发送全尺寸的段。只有分组确认或者积累达到全尺寸的数据时，才会发送。

5，端口耗尽。当关闭某个tcp链接时，会在内存创建内存块，记录刚断开的端口与ip，确保两分钟内不会再被创建同样的链接。会遇到端口有限问题。可以增加机器数量、循环使用虚拟。

#### 串行事务处理时延

1，并行连接，通常是4个，一般也不会超过8个。缺点是：因为慢启动的特性，新连接会降低性能，并且可打开的链接时有限的。

2，持久连接。用connection:keep-alive来请求进行持久连接，如果响应中没有keep-alive则是表示不支持。keep-alive:max=5,timeout=120表示为5个事务保持持久连接，空闲时间为2分钟。盲中继问题。如果不想保持持久连接，要加上Connection: close来关闭连接。注意的是content-length必须与内容长度一致或者是分段传输才能保持持久化连接。http1.1都是keep-alive。http1.0：keep-alive; http1.1: persistent。

3，管道化连接。第一条请求达到服务器时，第二条、第三条就可以发送。客户端必须做好请求被提前关闭的准备。不能用做非幂等的post请求。如果服务端关闭连接时，客户端还有数据要发送，客户端就会在写入一半时，就会连接错误。

4，复用连接

#### 代理

代理是连接多个协议相同的应用程序，网关是协议转换器。

代理作用：出口代理、访问代理、反向代理、网络交换代理。

#### 缓存

Expires: time  过期时间。如果过指定时间，文档就不再新鲜。

Cache-control: max-age=490 以秒为单位。为文档的最大可使用期限。

If-Modified-since: time  如果指定日期修改后，则请求

If-Node-Match: tag  如果tag与服务器不一致，则请求


#### 传输

`Content-length`如果没有报文主体，则不可参考`content-length`，如head请求。

`Transfer-encoding`的值只有`chunked`，表示分块传输，每块包含16进制的长度值与数据，长度值单独占一行，最后一个块的长度值比为0.
